---
title: "P8106_HW2"
author: "Ziyi Zhao"
date: "3/19/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(caret)
library(splines)
library(lasso2)
library(mgcv)


```



```{r}
college <- read_csv("./College.csv") %>% janitor::clean_names()

train_college <- filter(college,college!="Columbia University")

## matrix of predictors 
x <- model.matrix(outstate~.,train_college)[,c(565:580)]

## vector of response
y <- train_college$outstate

```


## (a) Create scatter plots of response vs. predictors.

```{r}
theme1 <- trellis.par.get()
theme1$plot.symbol$col <- rgb(0.2,0.4,0.2,0.5)
theme1$plot.symbol$pch <- 16
theme1$plot.line$col <- rgb(0.8,0.1,0.1,0.1)
theme1$plot.line$lwd <- 2
theme1$strip.background$col <- rgb(0.0,0.2,0.6,0.2)
trellis.par.set(theme1)
featurePlot(x,y,plot="scatter",labels = c("","Y"),
            type=c("p"),layout=c(4,4))

```


## (b) Fit a smoothing spline model using Terminal as the only predictor of Outstate for a range of degrees of freedom, as well as the degree of freedom obtained by generalized cross validation, and plot the resulting ﬁts. Describe the results obtained.


```{r}
fit.ss <- smooth.spline(train_college$terminal,train_college$outstate)
fit.ss$df

terminallims <- range(train_college$terminal)
terminal.grid <- seq(from=terminallims[1],to=terminallims[2])

pred.ss <- predict(fit.ss,
                   x=terminal.grid)

pred.ss.df <- data.frame(pred=pred.ss$y,
                         terminal=terminal.grid)

p <- ggplot(data=train_college,aes(x=terminal,y=outstate))+
  geom_point(color=rgb(0.2,0.4,0.2,0.5))

p + geom_line(aes(x=terminal,y=pred),data=pred.ss.df,
              color = rgb(0.8,0.1,0.1,1)) + theme_bw()
  

```

According to the output, the degreee of freedom obtained by generalized cross-validation is `r fit.ss$df`.

The solution of smooth function g(x) is a natural cubic spline with knots at every unique value of variable terminal ranged from `r terminallims[1]` to `r terminallims[2]`.

From the plot, the scatter plot shown in green points is the train dataset of college with terminal as x-axis and outstate as y-axis. The red fitted curve is generated by predicted dataset of outstate by every unique value of terminal. The predicted curve fits the data smoothly.


## (c) Fit a generalized additive model (GAM) using all the predictors. Plot the results and explain your ﬁndings.

```{r}


```






